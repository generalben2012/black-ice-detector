# 4단계: 웹 인터페이스 작성

이 문서는 거리 값을 실시간으로 표시하는 웹 인터페이스를 작성하는 방법을 설명합니다.

## 목표

- WebSocket을 사용하여 Python 백엔드와 실시간 통신
- 거리 값을 시각적으로 표시
- 연결 상태 및 측정 상태 표시

## 웹 인터페이스 구조

웹 인터페이스는 세 가지 파일로 구성됩니다:

1. **index.html**: HTML 구조
2. **style.css**: 스타일링
3. **app.js**: JavaScript 로직 (WebSocket 통신)

## 1. HTML 구조 작성

**파일 위치:** `black-ice-detector/assets/index.html`

### 주요 요소

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Ice Detector</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="arduino-text">Black Ice Detector</h1>
        </div>

        <div class="main-content">
            <div class="distance-display-container">
                <!-- 거리 표시 카드 -->
                <div class="distance-card">
                    <div class="distance-label">거리 (Distance)</div>
                    <div class="distance-value" id="distanceValue">--</div>
                    <div class="distance-unit">cm</div>
                    <div class="distance-status" id="distanceStatus">
                        <span class="status-indicator" id="statusIndicator"></span>
                        <span id="statusText">센서 연결 중...</span>
                    </div>
                </div>

                <!-- 조도 센서 표시 카드 -->
                <div class="ldr-card">
                    <div class="ldr-label">조도 센서 (LDR)</div>
                    <div class="ldr-value" id="ldrValue">--</div>
                    <div class="ldr-unit">0~1023</div>
                </div>

                <!-- 정보 카드 -->
                <div class="info-card">
                    <h3>센서 정보</h3>
                    <div class="info-item">
                        <span class="info-label">센서 모델:</span>
                        <span class="info-value">HC-SR04</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">측정 범위:</span>
                        <span class="info-value">2cm ~ 400cm</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">업데이트 주기:</span>
                        <span class="info-value">100ms (10회/초)</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="errorContainer" class="error-message" style="display: none;"></div>
    </div>

    <script src="libs/socket.io.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
```

### HTML 요소 설명

- **distanceValue**: 거리 값을 표시하는 요소
- **ldrValue**: 조도 센서 값을 표시하는 요소
- **statusIndicator**: 연결 상태를 표시하는 색상 인디케이터
- **statusText**: 상태 텍스트를 표시하는 요소
- **errorContainer**: 오류 메시지를 표시하는 요소

## 2. CSS 스타일 작성

**파일 위치:** `black-ice-detector/assets/style.css`

### 주요 스타일

```css
.distance-card {
    background: white;
    border-radius: 16px;
    padding: 40px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.distance-value {
    font-size: 72px;
    font-weight: 700;
    color: #008184;
    font-family: "Roboto Mono", monospace;
}

.ldr-card {
    background: white;
    border-radius: 16px;
    padding: 40px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.ldr-value {
    font-size: 72px;
    font-weight: 700;
    color: #008184;
    font-family: "Roboto Mono", monospace;
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
}

.status-indicator.active {
    background-color: #4caf50;  /* 녹색 */
}

.status-indicator.error {
    background-color: #f44336;  /* 빨간색 */
}
```

### 반응형 디자인

모바일 기기에서도 잘 보이도록 반응형 스타일을 추가합니다:

```css
@media (max-width: 768px) {
    .distance-value {
        font-size: 56px;
    }
}
```

## 3. JavaScript 로직 작성

**파일 위치:** `black-ice-detector/assets/app.js`

### WebSocket 연결

```javascript
const socket = io(`http://${window.location.host}`);
```

- Socket.IO를 사용하여 Python 백엔드에 연결

### 이벤트 핸들러

#### 1. 연결 이벤트

```javascript
socket.on('connect', () => {
    console.log('Connected to server');
    isConnected = true;
    updateConnectionStatus(true);
});
```

#### 2. 거리 업데이트 이벤트

```javascript
socket.on('distance_update', (data) => {
    updateDistanceDisplay(data);
});
```

**메시지 형식:**
```json
{
    "distance": 25.5,
    "duration": 1457,
    "distance_mm": 255.0,
    "ldr_value": 512,
    "timestamp": "2025-01-20T10:30:45.123456+00:00",
    "unit": "cm",
    "valid": true
}
```

#### 3. 거리 표시 업데이트 함수

```javascript
function updateDistanceDisplay(data) {
    if (!data) return;

    const distance = data.distance;
    const isValid = data.valid !== false && distance > 0;

    // Update distance value
    if (isValid) {
        distanceValueEl.textContent = distance.toFixed(2);
        distanceValueEl.classList.remove('invalid');
    } else {
        distanceValueEl.textContent = '--';
        distanceValueEl.classList.add('invalid');
    }

    // Update LDR value
    if (data.ldr_value !== undefined && data.ldr_value >= 0) {
        ldrValueEl.textContent = data.ldr_value;
        ldrValueEl.classList.remove('invalid');
    } else {
        ldrValueEl.textContent = '--';
        ldrValueEl.classList.add('invalid');
    }

    // Update status
    if (isValid) {
        statusIndicatorEl.className = 'status-indicator active';
        statusTextEl.textContent = '정상 측정 중';
    } else {
        statusIndicatorEl.className = 'status-indicator error';
        statusTextEl.textContent = '측정 범위를 벗어났습니다';
    }
}
```

### 상태 표시

연결 상태와 측정 상태를 시각적으로 표시합니다:

- **녹색 (active)**: 정상 측정 중
- **빨간색 (error)**: 오류 또는 측정 범위 벗어남
- **주황색 (warning)**: 데이터 업데이트 대기 중

## Socket.IO 라이브러리

Socket.IO 라이브러리는 다른 프로젝트에서 복사하거나 CDN에서 가져올 수 있습니다:

**파일 위치:** `black-ice-detector/assets/libs/socket.io.min.js`

다른 프로젝트에서 복사:
```bash
cp ../uno-q-pin-toggle/assets/libs/socket.io.min.js assets/libs/
```

또는 CDN 사용 (HTML에서):
```html
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
```

## 테스트

### 로컬 테스트

1. Arduino App Lab에서 앱 실행
2. 웹 브라우저에서 `<board-name>.local:7000` 접속
3. 거리 값이 실시간으로 업데이트되는지 확인

### 브라우저 개발자 도구

브라우저 개발자 도구(F12)를 열어 다음을 확인합니다:

- **Console**: WebSocket 연결 메시지 및 오류 확인
- **Network**: WebSocket 연결 상태 확인

## 커스터마이징

### 거리 표시 형식 변경

소수점 자릿수 변경:
```javascript
distanceValueEl.textContent = distance.toFixed(1);  // 소수점 1자리
```

단위 변경:
```javascript
// 미터로 변환
const distanceInMeters = distance / 100;
distanceValueEl.textContent = distanceInMeters.toFixed(2);
unitEl.textContent = 'm';
```

### 색상 테마 변경

CSS에서 색상 변경:
```css
.distance-value {
    color: #ff6b6b;  /* 빨간색 */
}

.status-indicator.active {
    background-color: #51cf66;  /* 밝은 녹색 */
}
```

### 추가 정보 표시

HTML에 추가 요소:
```html
<div class="timestamp" id="timestamp">--</div>
```

JavaScript에서 업데이트:
```javascript
timestampEl.textContent = new Date(data.timestamp).toLocaleString();
```

## 문제 해결

### WebSocket 연결 실패

**원인:**
- Python 백엔드가 실행되지 않음
- 포트 충돌
- 네트워크 문제

**해결:**
1. Arduino App Lab에서 앱이 실행 중인지 확인
2. 브라우저 콘솔에서 오류 메시지 확인
3. 네트워크 연결 확인

### 거리 값이나 조도 값이 업데이트되지 않음

**원인:**
- WebSocket 메시지 수신 실패
- JavaScript 오류
- DOM 요소 ID 불일치

**해결:**
1. 브라우저 콘솔에서 JavaScript 오류 확인
2. `socket.on('distance_update')` 이벤트 핸들러 확인
3. Python 백엔드에서 메시지가 전송되는지 확인
4. DOM 요소 ID 확인:
   - `distanceValue` - 거리 값 표시
   - `ldrValue` - 조도 값 표시

### 스타일이 적용되지 않음

**원인:**
- CSS 파일 경로 오류
- 캐시 문제

**해결:**
1. CSS 파일 경로 확인
2. 브라우저 캐시 삭제 (Ctrl+Shift+R)

## 완성된 프로젝트 확인

모든 파일이 올바르게 작성되었는지 확인:

```
black-ice-detector/
├── app.yaml
├── python/
│   └── main.py
├── sketch/
│   └── sketch.ino
├── assets/
│   ├── index.html
│   ├── app.js
│   ├── style.css
│   └── libs/
│       └── socket.io.min.js
└── README.md
```

## 다음 단계

웹 인터페이스가 완성되었으므로 다음 단계로 진행합니다:

- [5단계: 센서 연결 및 테스트](05-센서-연결-및-테스트.md) - 하드웨어 연결 및 전체 시스템 테스트

## 체크리스트

- [ ] HTML 파일 작성 완료
- [ ] CSS 파일 작성 완료
- [ ] JavaScript 파일 작성 완료
- [ ] Socket.IO 라이브러리 추가 완료
- [ ] 브라우저에서 테스트 완료
- [ ] 반응형 디자인 확인 완료

